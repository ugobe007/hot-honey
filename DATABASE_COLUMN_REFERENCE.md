# Database Schema & Naming Conventions

## âš ï¸ IMPORTANT: Preventing Column/Table Name Mismatches

This document serves as the authoritative reference for database table and column names.
Always refer to this document when writing queries or accessing database fields.

---

## ğŸ—„ï¸ Correct Table Names

| âŒ WRONG | âœ… CORRECT | Description |
|----------|------------|-------------|
| `matches` | `startup_investor_matches` | Investor-startup matching records |
| `startups` | `startup_uploads` | Main startup data table |

### Usage Examples

```typescript
// âŒ WRONG
supabase.from('matches').select('*')
supabase.from('startups').select('*')

// âœ… CORRECT
supabase.from('startup_investor_matches').select('*')
supabase.from('startup_uploads').select('*')
```

---

## ğŸ¦ Investor Table Column Mapping

| âŒ WRONG (Frontend) | âœ… CORRECT (Database) | Type |
|---------------------|----------------------|------|
| `investor.sectors` | `investor.sector_focus` | `string[]` |
| `investor.stage` | `investor.stage_focus` | `string[]` |
| `investor.check_size` | `investor.check_size_min` & `investor.check_size_max` | `number` |
| `investor.portfolio_count` | `investor.portfolio_size` | `number` |
| `investor.description` | `investor.bio` | `string` |
| `investor.contact_email` | `investor.email` | `string` |

### Service Layer Mapping

The `investorService.ts` now maps database columns to frontend-friendly names:

```typescript
// Database column â†’ Frontend property
sector_focus â†’ sectors
stage_focus â†’ stage
check_size_min â†’ checkSizeMin
check_size_max â†’ checkSizeMax
portfolio_size â†’ portfolioCount
bio â†’ description
email â†’ contactEmail
```

---

## ğŸ“Š Match Status Values

The `startup_investor_matches` table uses a `status` column with the following values:

| Status | Description | Use Case |
|--------|-------------|----------|
| `suggested` | Match generated by algorithm | Initial state |
| `viewed` | Investor viewed the match | User engagement |
| `intro_requested` | Startup requested intro | User action |
| `intro_sent` | Introduction email sent | Admin action |
| `contacted` | Direct contact made | Communication |
| `declined` | Match rejected | Negative outcome |
| `meeting_scheduled` | Meeting was scheduled | Positive outcome |
| `funded` | Investment was made | **Success** |

### âš ï¸ NO `investment_made` Column!

```typescript
// âŒ WRONG - This column doesn't exist!
.eq('investment_made', true)

// âœ… CORRECT - Use status column
.eq('status', 'funded')
```

---

## ğŸ“ Key Files Reference

| File | Purpose |
|------|---------|
| `src/types/database.types.ts` | Type definitions & constants |
| `src/lib/investorService.ts` | Investor CRUD with mapping |
| `src/lib/startupService.ts` | Startup CRUD operations |

### Using Constants (Recommended)

```typescript
import { DB_TABLES, MATCH_STATUS } from '../types/database.types';

// Using table name constant
supabase.from(DB_TABLES.STARTUP_INVESTOR_MATCHES).select('*')

// Using status constant
.eq('status', MATCH_STATUS.FUNDED)
```

---

## ğŸ”§ Type-Safe Queries

Import and use the generated types:

```typescript
import { Database, Investor, Startup, StartupInvestorMatch } from '../types/database.types';

// Type-safe query result
const { data } = await supabase
  .from('investors')
  .select('*')
  .returns<Investor[]>();
```

---

## ğŸ“‹ Complete Investor Table Schema

```typescript
interface Investor {
  id: string;
  name: string;
  firm: string | null;
  type: string | null;
  
  // âš ï¸ USE THESE - NOT 'sectors' or 'stage'
  sector_focus: string[] | null;
  stage_focus: string[] | null;
  check_size_min: number | null;
  check_size_max: number | null;
  
  bio: string | null;
  tagline: string | null;
  geography: string | null;
  location: string | null;
  website: string | null;
  linkedin: string | null;
  twitter: string | null;
  email: string | null;
  
  fund_size: string | null;
  aum: string | null;
  portfolio_size: number | null;
  investment_pace: number | null;
  leads_rounds: boolean | null;
  
  exits: number | null;
  unicorns: number | null;
  board_seats: number | null;
  notable_investments: string[] | null;
  
  partners: Json | null;
  embedding: string | null;
  status: string | null;
  last_investment_date: string | null;
  last_enrichment_date: string | null;
  created_at: string | null;
  updated_at: string | null;
}
```

---

## ğŸš¨ Common Mistakes to Avoid

1. **Using wrong table names**
   - `matches` â†’ Use `startup_investor_matches`
   - `startups` â†’ Use `startup_uploads`

2. **Using wrong column names**
   - `sectors` â†’ Use `sector_focus`
   - `stage` â†’ Use `stage_focus`
   - `investment_made` â†’ Use `status = 'funded'`

3. **Accessing frontend vs database properties**
   - When reading from `getAllInvestors()`: use `investor.sectors`, `investor.stage`
   - When querying database directly: use `sector_focus`, `stage_focus`

4. **Not using type constants**
   - Always import `DB_TABLES` and `MATCH_STATUS` from database.types.ts

---

## ğŸ“ Updating This Documentation

If you modify the database schema:

1. Run `mcp_supabase_generate_typescript_types` to regenerate types
2. Update `src/types/database.types.ts` with new types
3. Update this documentation file
4. Update any service layer mappings in `investorService.ts`
